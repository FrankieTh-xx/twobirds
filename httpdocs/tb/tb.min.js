/**
 * twoBirds V7 core functionality
 *
 * @author          frank.thuerigen <frank_thuerigen@yahoo.de>
 * @copyright       copyright (c) 2006- Frank ThÃ¼rigen
 * @license         http://www.gnu.org/copyleft/gpl.html GNU GPL v3
 *
 */
tb=function(){function t(t,e,a){var o,i=r("")
return t instanceof n&&[].forEach.call([].map.call(t,function(e,n){return t.hasOwnProperty(n)?t[n]:void 0}),function(t,n){o=t[e].apply(t,[].slice.call(a)),[].forEach.call(o,function(t){-1===[].indexOf.call(i,t)&&[].push.call(i,t)})}),i}function e(t,e,n){var r=this
r.bubble=n||"l",r.data=e||{},r.name=t||"",r.__stopped__=r.__immediateStopped__=!1}function n(t){var e=this,n=[]
switch(e.length=0,typeof t){case"string":new a(t).filter("[data-tb]").filter(function(t){var e=t.getAttribute("data-tb").split(" ")
e[0]&&e.forEach(function(e){t[e]&&t[e].__tb__&&n.push(t[e])})})
break
case"object":t instanceof RegExp?a("[data-tb]").map(function(e){var r=e.getAttribute("data-tb").split(" ")
r[0]&&r.forEach(function(r){r.match(t)&&e[r]&&n.push(e[r])})}):t.nodeType&&a(t).map(function(e){var r=e.getAttribute("data-tb").split(" ")
r[0]&&r.forEach(function(r){r.match(t)&&e[r]&&e[r].__tb__&&n.push(e[r])})})
break
case"function":a("[data-tb]").map(function(e){var r=e.getAttribute("data-tb").split(" ")
r[0]&&r.forEach(function(r){e[r]&&e[r].__tb__&&e[r]instanceof t&&n.push(e[r])})})}return n.map(function(t){[].push.call(e,t)}),e}function r(){function t(t){var e=function(t){var e=this
for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}
return e.prototype=r.prototype,new e(t)}var e=this
if(!(e instanceof r))return new n(arguments[0]?arguments[0]:"")
var a,o,i="string"==typeof arguments[0],c=i?r.namespace(arguments[0]):arguments[0]
if(i&&!c)return o=arguments[0].replace(/\./g,"/")+".js",void r.loader.load(o,function(t){return function(){new r(t[0],t[1]||{},t[2]||!1)}}([].slice.call(arguments)))
if("function"==typeof c){if(c.prototype.__tb__||(c.prototype.__tb__="V7.0a",c.prototype=t(c.prototype,c)),a=new c(arguments[1]||{},arguments[2]),a.namespace||(a.namespace="string"==typeof arguments[0]?arguments[0]:arguments[0].namespace||r.getId()),a.target=arguments[2]||!1,arguments[2]?a.target=arguments[2]:a.target=null,a.target&&a.target.nodeType){a.target[a.namespace]=a
var s=r.dom(a.target)
if("head"!==a.target.nodeName&&-1===s.parents().toArray().indexOf(document.head)&&s.addClass(a.namespace.replace(/\./g,"-").toLowerCase()),a.target&&a.target.nodeType){var u=a.target.getAttribute("data-tb")
u&&u.length&&-1===u.split(" ").indexOf(a.namespace)?a.target.setAttribute("data-tb",u+" "+a.namespace):a.target.setAttribute("data-tb",a.namespace)}}if(a.handlers)for(var f in a.handlers)a.handlers.hasOwnProperty(f)&&("function"==typeof a.handlers[f]?a.handlers[f]=[a.handlers[f]]:a.handlers[f]instanceof Array||delete a.handlers[f])
else a.handlers={}
for(var l in a)a.hasOwnProperty(l)||"string"==typeof l&&l.indexOf(".")>-1&&(a[l]=new r(l,a[l],a))
return r.status.eventCount()>0?r.idle(function(){a.trigger("init")}):a.trigger("init"),a}}var a=function(){return function(t,e){function r(){var t=this,e=[]
return e=t.filter(function(t){return-1===e.indexOf(t)}),d(e)}function a(t){var e=this,n=new d,r=new d(t)
return e.forEach(function(t){-1===r.indexOf(t)&&n.add(t)}),n}function o(t){var e,n=this
return t instanceof Array?t.forEach(function(t){n.add(t)}):t.nodeType?n.push(t):"string"==typeof t&&n.add(new d(t).toArray()),e=n.unique()}function i(t){var e,n=this,r=(new d(t),new d)
return n.forEach(function(t){for(var n=t.parentNode;n&&n.tagName&&"html"!==n.tagName;)e=n.parentNode,-1===[].indexOf.call(r,n)&&r.push(n),n=e}),t&&(r=r.filter(t)),r}function c(t){var e=this,n=e.toArray()
return n.forEach(function(e){var n=e.getAttribute("class")||"";-1===n.split(" ").indexOf(t)&&e.setAttribute("class",n?n+" "+t:t)}),e}function s(t,e){var n,r=this
return!e&&r.length>0?r[0].getAttribute(t):(n=r.toArray(),n.forEach(function(n){n.setAttribute(t,e)}),r)}function u(){var t=this,e=[]
return t.length&&[].map.call(t,function(t){e.push(t)}),e}function f(t){var e,n=this,r=new d(t)
return"undefined"===t?n:("string"==typeof t?e=[].filter.call(n,function(t){return-1<r.indexOf(t)}):"function"==typeof t&&(e=[].filter.call(n,t)),new d(e))}function l(t){var e=this,n=[]
return"undefined"==typeof t?e:(t instanceof Array?t.forEach(function(t){e.push(t)}):t.nodeType?[].push.call(e,t):"string"==typeof t&&e.push(new d(t).toArray()),n=e.unique())}var d
return d=function(t,e){var r,a,o=this
if(t)return t.nodeType?void[].push.call(o,t):t[0]&&t[0]instanceof n?void[].forEach.call(t,function(t){t.target&&t.target.nodeType&&[].push.call(o,t)}):t instanceof Array?void[].forEach.call(t,function(t){t&&t.nodeType&&[].push.call(o,t)}):void("string"==typeof t&&(r=e&&e.nodeType?e:document,a=r.querySelectorAll(t),a.length&&[].forEach.call(a,function(t){o[o.length]=t,o.length++})))},d.prototype={length:0,concat:[].concat,every:[].every,forEach:[].forEach,indexOf:[].indexOf,keys:[].keys,lastIndexOf:[].lastIndexOf,map:[].map,pop:[].pop,reduce:[].reduce,reduceRight:[].reduceRight,reverse:[].reverse,shift:[].shift,slice:[].slice,some:[].some,splice:[].splice,unshift:[].unshift,add:o,addClass:c,attr:s,filter:f,not:a,parents:i,push:l,toArray:u,unique:r},new d(t,e)}}()
setTimeout(function(){r.dom=a},0),e.prototype={stopPropagation:function(){return this.__stopped__=!0,this},stopImmediatePropagation:function(){return this.stopPropagation(),this.__immediateStopped__=!0,this}},r.prototype=function(){return{trigger:function(t,a,o){var i,c=this
if(!r.stop())return i=t instanceof e?t:new e(t,a,o),c instanceof n&&c.hasOwnProperty(length)?[].forEach.call(c,function(t){t&&t.trigger(i)}):c.__tb__&&(c.handlers[i.name]&&i.bubble.indexOf("l")>-1&&(c.handlers[i.name]=c.handlers[i.name].map(function(t){return setTimeout(function(){i.bubble.indexOf("l")>-1&&!i.__immediateStopped__&&t.apply(c,[i])},0),t.once?void 0:t})),setTimeout(function(){i.__stopped__||i.__immediateStopped__||(i.bubble.indexOf("u")>-1&&(i.bubble+=-1===i.bubble.indexOf("l")?"l":"",c.parent().trigger(i)),i.bubble.indexOf("d")>-1&&(i.bubble+=-1===i.bubble.indexOf("l")?"l":"",c.children().trigger(i)))},0)),c},parents:function(e){var a=this,o=r()
return a instanceof n?o=t(a,"parents",arguments):a instanceof r&&a.target&&(a.target.nodeType?r.dom(a.target).parents("[data-tb]").not("html").toArray().forEach(function(t){t.getAttribute("data-tb").split(" ").forEach(function(e){var n=t[e]||null
n&&[].push.call(o,n)})}):a.target instanceof r&&([].push.call(o,a.target),a.target.parent()[0]&&[].push.call(o,a.target.parent()[0]))),e?o.filter(e):o},parent:function(e){var a=this,o=r()
if(a instanceof n)o=t(a,"parent",arguments)
else if(a instanceof r&&a.target)if(a.target.nodeType){var i=a.parents()[0]||!1
if(!i)return o
for(var c in i.target)i.target[c]instanceof r&&[].push.call(o,i.target[c])}else a.target instanceof r&&[].push.call(o,a.target)
return e?o.filter(e):o},descendants:function(e,a){var o=this,i=r()
if(o instanceof n)i=t(this,"descendants",arguments)
else if(o instanceof r&&o.target.nodeType&&!a)r.dom("[data-tb]",o.target).forEach(function(t){for(var e in t)pDomelement.hasOwnProperty[e]&&t[e]instanceof r&&[].push.call(i,t[e])})
else if(o instanceof r&&a)for(var c in o)if(o.hasOwnProperty(c)&&"target"!==c&&o[c]instanceof r){[].push.call(i,o[c])
for(var s=r.dom().toArray.call(o[c].descendants("",!0)),u=0,f=s.length;f>u;u++)[].push.call(i,s[u])}return e?i.filter(e):i},children:function(e,a){var o=this,i=r("")
if(o instanceof n)i=t(o,"children",arguments)
else if(o instanceof r&&o.target.nodeType&&!a)r.dom("[data-tb]",o.target).map(function(t){if(r(t).parent()[0].target===o.target)for(var e in t)t.hasOwnProperty(e)&&t[e]instanceof r&&[].push.call(i,t[e])})
else if(a)for(var c in o)o.hasOwnProperty(c)&&o[c]instanceof r&&[].push.call(i,o[c])
return e?i.filter(e):i},next:function(e){var a,o,i=this,c=r("")
return i instanceof n?c=t(this,"next",arguments):(a=i.parent().children(),o=[].indexOf.call(a,i),a.length>o+1&&[].push.call(c,a[o+1])),e?c.filter(e):c},prev:function(e){var a,o,i=this,c=r("")
return i instanceof n?c=t(this,"prev",arguments):(a=this.parent().children(),o=[].indexOf.call(a,this),o&&[].push.call(c,a[o-1])),e?c.filter(e):c},first:function(e){var a,o=this,i=r("")
return o instanceof n?i=t(this,"first",arguments):(a=this.parent().children(),[].push.call(i,a[0])),e?i.filter(e):i},last:function(e){var a,o=this,i=r("")
return o instanceof n?i=t(this,"last",arguments):(a=this.parent().children(),[].push.call(i,a[a.length-1])),e?i.filter(e):i},toArray:a().toArray,filter:function(t){var e=this,o=r(t).toArray(),i=r()
return t?(console.log("filter that, compare",e,o),e instanceof n?[].map.call(a().toArray.call(e),function(t){[].indexOf.call(o,t)>-1&&[].push.call(i,t)}):e instanceof r&&o.indexOf(e)>-1&&[].push.call(i,e),console.log("filter ret",i),i):e},not:function(t){var e,a,o=this
r(t).toArray()
return o instanceof n?e=o:(e=r(""),[].push.call(e,o)),o.each(check,function(t,n){a=[].indexOf.call(e,n),a>-1&&[].splice.apply(e,[a,1])}),e},is:function(t){var e,a,o=this,i=r(t).toArray()
return o instanceof n?e=o:(e=r(),[].push.call(e,o)),i.forEach(function(t){a=[].indexOf.call(e,t),-1===a&&[].splice.apply(e,[a,1])}),e},add:function(t){var e,a,o=this,i=r(t).toArray()
return o instanceof n?e=o:(e=r(""),[].push.call(e,o)),i.forEach(function(t){a=[].indexOf.call(e,t),-1===a&&[].push.call(e,t)}),e},on:function(e,r,a){var o=this
return r.once=!!r.once||!!a,o instanceof n?t(o,"on",arguments):o.__tb__&&(o.handlers||(o.handlers={}),o.handlers[e]||(o.handlers[e]=[]),o.handlers[e].push(r)),o},one:function(t,e){var n=this
return n.on(t,e,!0),n},off:function(e,r){var a,o=this
if(o instanceof n)t(o,"off",arguments)
else if(o.__tb__){if(!o.handlers[e])return
a=o.handlers[e].indexOf(r),a>-1&&o.handlers[e].splice(a,1)}return o}}}(),n.prototype={}
for(var o in r.prototype)r.prototype.hasOwnProperty(o)&&(n.prototype[o]=r.prototype[o])
return r}(),tb.require=function(t){var e=this
e.target
t&&(e.requirements=t,tb.loader.load(e.requirements,function(){}))},tb.require.prototype={ready:function(){}},tb.stop=function(t){var e=t
return function(t){return e=t?t:e}}(!1),tb.getId=function(){return"id-"+(new Date).getTime()+"-"+Math.random().toString().replace(/\./,"")},tb.namespace=function(t,e,n){if("string"!=typeof t)return!1
var r=t.split("."),a=function(t,n){return!t[n[0]]&&e&&(t[n[0]]={}),n.length<2?t[n[0]]||!1:t[n[0]]?(t=t[n[0]],n.shift(),a(t,n)):!1}
return a(n?n:window,r)},tb.bind=function(t){var e,n=[],r=document.querySelectorAll(t)
if("string"==typeof t)e=document.querySelectorAll(t)[0]||!1
else{if(!(t instanceof HTMLElement))return
e=t}e&&e.getAttribute("data-tb")&&n.push(e),r.length&&[].map.call(r,function(t){n.push(t)}),n.forEach(function(t){var e=t.getAttribute("data-tb").split(" ")
e.forEach(function(e){t[e]||(t[e]=new tb(e,null,t))})})},tb.observable=function(t){var e=t,n=function(t){return void 0!==t&&(e=t,n.notify()),e}
return n.list=[],n.notify=function(){n.list.forEach(function(t,r){"function"==typeof t?(t(e),t.once&&n.list.splice(r,1)):n.list.splice(r,1)})},n.observe=function(t,e){t.once=e||!1,n.list.push(t)},n},tb.status={eventCount:tb.observable(0)},tb.idle=function(t){var e=function(){0===tb.status.eventCount()?t():tb.status.eventCount.observe(e,!0)}
tb.status.eventCount.observe(e,!0)},tb.Model=function(t){var e=this
e.data=tb.observable({}),e.config={},tb.extend(e.config,{create:{url:"",method:"PUT",success:function(t){e.data(t)}},read:{url:"",method:"GET",success:function(t){e.data(t)}},update:{url:"",method:"POST",success:function(t){e.data(t)}},"delete":{url:"",method:"DELETE",success:function(t){e.data(t)}}},t)},tb.Model.prototype=function(){function t(t,e){var n,r,a=/^\{.*\}$/
return r=JSON.parse(JSON.stringify(e)),Object.keys(r).forEach(function(e){var o=r[e]
n=!!a.exec(o)&&!!a.exec(o)[0],n?(r[e]=tb.parse(o,t),a.exec(r[e])&&a.exec(r[e])[0]&&console.error("mapped variable not found in data:",o,!!a.exec(o)[0])):t.hasOwnProperty(e)?r[e]=t[e]:console.error("variable not found in data:",e,"in",t)}),e}return{create:function(e){var n=tb.extend({},this.config.create),r={},a=e||{}
return n.url?(n.params&&(r=t(a,n.params)),void tb.request(tb.extend(n,{url:r?tb.parse(this.config.create.url,r):this.config.create.url},{data:r?r:{}}))):void console.error("no create url given!")},read:function(e){var n=tb.extend({},this.config.read),r={}
return n.url?(n.params&&(r=t(e,n.params)),void tb.request(tb.extend(n,{url:r?tb.parse(this.config.read.url,r):this.config.read.url},{data:r?r:{}}))):void console.error("no read url given!")},update:function(e){var n=tb.extend(!0,{},this.config.update),r={},a=e||{}
return n.url?(n.params&&(r=t(a,n.params)),void tb.request(tb.extend(n,{url:r?tb.parse(this.config.update.url,r):this.config.update.url},{data:r?r:{}}))):void console.error("no update url given!")},"delete":function(e){var n=tb.extend(!0,{},this.config["delete"]),r={},a=e||{}
return n.url?(n.params&&(r=t(a,n.params)),void tb.request(tb.extend(n,{url:r?tb.parse(this.config["delete"].url,r):this.config["delete"].url},{data:r?r:{}}))):void console.error("no delete url given!")}}}(),tb.extend=function(t){for(var e=JSON.parse(JSON.stringify(pSrc));arguments[1];)Object.keys(e).forEach(function(n){e[n].constructor===Object?t[n]=tb.extend(t[n]||{},e[n]):t[n]=e[n]}),[].splice.call(arguments,1,1)
return t},tb.parse=function(t,e){var n=t.match(/\{.*\}/),r=e,a=!1,o=[]
return n&&(r=e,n.forEach(function(e){for(a=!1,o=e.replace("{","").replace("}","").split(".");o.length>0&&!a;)r[o[0]]?(r=r[o[0]],o.shift()):a=!0
t=t.replace(e,a?e:r)})),t},function(){function t(t){return t.split("?")[0].split(".").pop()}var e=function(e){function n(t){t&&t.data&&o.data(t.data),o.done=!0,"js"===o.type&&setTimeout(function(){},200)}var r,a,o=this,i=t(e.src),c={css:{tag:"link",attributes:{type:"text/css",rel:"stylesheet",href:"{src}"}},js:{tag:"script",attributes:{type:"text/javascript",src:"{src}"}}},s=!!c[i]
if(e.type=i,o.config=e,o.config.src&&(o.config.src=o.config.src+(o.config.src.indexOf("?")>-1?"&":"?")+tb.getId()),o.src=e.src,o.type=o.config.type=i,o.done=!1,o.cb=o.config.cb||function(){},o.data=tb.observable({}),n.once=!0,o.handlers={onLoad:n},s){r=c[i],a=document.createElement(r.tag),a.async=!0,a.onreadystatechange=a.onload=function(){var t=a.readyState
o.done||t&&!/loaded|complete/.test(t)||(tb.status.eventCount(tb.status.eventCount()-1),o.trigger("onLoad"))}
for(var u in r.attributes)r.attributes.hasOwnProperty(u)&&a.setAttribute(u,tb.parse(r.attributes[u],o.config))
tb.status.eventCount(tb.status.eventCount()+1),document.getElementsByTagName("head")[0].appendChild(a),o.element=a}else{var f=function(t){o.data(t),o.trigger("onLoad",t)},l={url:o.src,success:f,error:f}
tb.request(l)}}
e.prototype={namespace:"_Requirement"}
var n=function(t){var e=this
e.type=t.type,e.target=t.target,e.requirements={}}
n.prototype={namespace:"_RequirementGroup",load:function(t,n){var r,a=this,o=!!a.requirements[t]
o=o?a.requirements[t]:a.requirements[t]=new tb(e,{src:t,cb:n,target:a.target},a.requirements),r=function(){n(this)},o.on("onLoad",r,!0),o.done&&o.trigger("onLoad")}}
var r=function(t){var e=this
e.config=t,e.requirementGroups={}}
r.prototype={namespace:"_Head",load:function(e,r){var a,o,i,c=this,r=r||function(t){console.log("onLoad dummy handler on",t)}
return"string"!=typeof e?(i=function(t,e){return function(n){var r=t.indexOf(n.src)
t.splice(r,1),t.length||e()}}(e,r),void e.forEach(function(t){c.load(t,i)})):(a=t(e),o=!!c.requirementGroups[a],o||(c.requirementGroups[a]=new tb(n,{type:a},c.requirementGroups)),o=c.requirementGroups[a],void o.load(e,r))},data:function(e,n){var r=this,a=t(e),o=r.requirementGroups[a]?r.requirementGroups[a]:!1,i=o&&o.requirements[e]?o.requirements[e]:!1
return i?i.data(n):"unknown: "+e}},tb.loader=new tb(r)}(),tb.request=function(){function t(t){var e,n,r={}
if("undefined"!=typeof ActiveXObject)for(var a=0;a<l.length;++a)try{e=new ActiveXObject(l[a]),r={connection:e,identifier:t},n=function(t){return function(n){new ActiveXObject(t)
return r={connection:e,identifier:n}}}(l[a])}catch(o){}try{e=new XMLHttpRequest,r={connection:e,identifier:t},n=function(t){var e=new XMLHttpRequest
return r={connection:e,identifier:t}}}catch(o){}finally{return r}}function e(t,e,r,a){var o=window.setInterval(function(r){return function(){t.connection.readyState!==r&&(r=t.connection.readyState),4===r&&(t.aborttimer&&window.clearTimeout(t.aborttimer),window.clearInterval(o),n(t,e,a))}}(0),f)
return o}function n(t,e,n){try{var o=t.connection.status}catch(i){var o=13030}if(o>=200&&300>o){var c=r(t,e.argument)
try{e.apply(e,[c.responseXml,c.responseText,c])}catch(i){tb.debug}}else{var c=r(t,e.argument)
n.apply(n,[c])}a(t)}function r(t,e){var n={tId:t.identifier,status:t.connection.status,statusText:t.connection.statusText,allResponseHeaders:t.connection.getAllResponseHeaders(),responseText:t.connection.responseText,responseXML:t.connection.responseXML,argument:e?e:null}
return n}function a(t){i(t),t.connection&&(t.connection=null),delete t.connection,t=null,delete t}function o(t){c.push(t),u++,s="loading"}function i(t){c.indexOf(t)&&(u--,c.splice(c.indexOf(t)),0===u&&(s="complete"))}var c=[],s="complete",u=0,f=30,l=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"]
return function(n){var r="tb"+tb.getId(),i=!1,c=(n.method?n.method.toUpperCase():!1)||"GET",s=n.url,u="",f=n.success||tb.nop,l=n.error||tb.nop,d=n.statechange||tb.nop,p=n.cachable||!1,h=n.timeout||!1,b="undefined"==typeof n.async||n.async!==!1
if("undefined"!=typeof n.parms){var g=n.headers&&n.headers["Content-Type"]?n.headers["Content-Type"]:"application/x-www-form-urlencoded"
switch(g){case"application/json":u=JSON.stringify(n.parms)
break
default:for(var v in n.parms)u+=(u.length>0?"&":"")+v+"="+n.parms[v]}}if(o(),p===!1&&(s+=(s.indexOf("?")<0?"?":"&")+"tbUid="+r),i=t(r)){if("GET"===c&&""!==u&&(s=s+(s.indexOf("?")<0?"?":"&")+u),i.src=s,i.connection.open(c,s,b),b===!0&&(i.poll=e(i,f,d,l,s)),n.headers)for(var v in n.headers)"Content-Type"!==v&&i.connection.setRequestHeader(v,n.headers[v])
return h&&(i.timeoutTimer=window.setTimeout(function(t,e){var n="function"==typeof t.cb?t.cb:!1
return function(){"function"==typeof n&&n(),e.connection.abort(),window.clearInterval(e.poll)}}(h,i),h.ms)),i.abort=function(t){return function(){window.clearInterval(t.poll),t.connection&&t.connection.abort(),a(t)}}(i),("POST"===c||"PUT"===c)&&""!==u?(i.connection.setRequestHeader("Content-Type",g),i.connection.send(u)):i.connection.send(null),b!==!1?i:(tb.request.dec(),void(i.connection.status>=200&&i.connection.status<300?f(i.connection.responseXML,i.connection.responseText):failureHandler(i)))}return!1}}(),function(){function t(){tb.bind("body")}document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),t()},!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),t())})}()
